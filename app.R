# require(devtools)
# devtools::install_github("rCharts", "ramnathv")
library(DT)
library(shinydashboard)
library(rCharts)
library(googleVis)

duration_trends <- structure(list(Year = c(2003, 2004, 2005, 2006, 2007, 2008, 2009, 
2010, 2011, 2012, 2013, 2014), Rate = c(38.0237061377773, 38.6103274528162, 
39.2842754386741, 39.7831901885144, 40.2910095610645, 40.588416244016, 
41.2682153046045, 41.2838770112703, 42.0569518832949, 42.0929162681247, 
39.5287382630357, 39.5917588706601), Predicted = c(38.3749943277221, 
38.806916903754, 39.2388394797858, 39.6707620558177, 40.1026846318496, 
40.5346072078814, 40.9665297839133, 41.3984523599452, 41.830374935977, 
42.2622975120089, 42.6942200880408, 43.1261426640726)), .Names = c("Year", 
"Rate", "Predicted"), row.names = c(NA, -12L), class = "data.frame")

duration_overall <- structure(list(Year = c(2012, 2013), Rate = c(42.1545574561651, 
39.6347422319602), Matches = c(4445L, 4354L), Lower = c(35, 33.6774916013438
), Upper = c(50.4761904761905, 46.304347826087)), .Names = c("Year", 
"Rate", "Matches", "Lower", "Upper"), row.names = c(NA, -2L), class = "data.frame")

duration_surface <- structure(list(Year = c(2012, 2012, 2012, 2013, 2013, 2013), 
    Surface = structure(c(1L, 2L, 3L, 1L, 2L, 3L), .Label = c("Clay", 
    "Grass", "Hard"), class = "factor"), Rate = c(43.7641943513526, 
    38.7976765659837, 42.0391869781263, 40.2022583011925, 37.6046360315021, 
    39.7572425331385), Matches = c(1268L, 521L, 2656L, 1232L, 
    504L, 2618L), Lower = c(36.4285714285714, 33.0726652187403, 
    35.4354745925216, 34.1818181818182, 31.3483146067416, 33.8461538461538
    ), Upper = c(52.2772277227723, 44.5667570825799, 49.3343629343629, 
    47.244094488189, 43.886925795053, 45.7627118644068)), .Names = c("Year", 
"Surface", "Rate", "Matches", "Lower", "Upper"), row.names = c(NA, 
-6L), class = "data.frame")


duration_tier <- structure(list(Year = c(2012, 2012, 2012, 2012, 2012, 2013, 2013, 
2013, 2013, 2013), Tier = structure(c(1L, 2L, 3L, 4L, 5L, 1L, 
2L, 3L, 4L, 5L), .Label = c("1000", "250", "500", "Grand Slam", 
"Tour Finals"), class = "factor"), Rate = c(43.2108387710325, 
41.4770395324199, 41.5637540779384, 41.846324521407, 44.5573592133827, 
40.2615008364302, 39.2782505699517, 39.1603781155095, 39.445288549169, 
45.3628125750888), Matches = c(1447L, 1177L, 615L, 1198L, 8L, 
1413L, 1098L, 593L, 1244L, 6L), Lower = c(36.1490683229814, 34.9180327868852, 
34.4186046511628, 34.3478260869565, 42.4083769633508, 34.1717121588089, 
33.75, 33.4824204735709, 32.8846153846154, 41.7391304347826), 
    Upper = c(52.258064516129, 48.4887640449438, 50.6422018348624, 
    49.004080839487, 48.2926829268293, 46.6187050359712, 44.6511627906977, 
    45, 46.6666666666667, 48.4033613445378)), .Names = c("Year", 
"Tier", "Rate", "Matches", "Lower", "Upper"), row.names = c(NA, 
-10L), class = "data.frame")


duration_player <- structure(list(Year = c(2012, 2012, 2012, 2012, 2012, 2012, 2012, 
2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 
2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 
2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 
2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 
2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 
2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 
2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 
2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 
2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 
2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 
2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 
2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 
2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 
2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 2012, 
2012, 2012, 2012, 2012, 2012, 2012, 2012, 2013, 2013, 2013, 2013, 
2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 
2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 
2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 
2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 
2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 
2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 
2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 
2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 
2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 
2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 
2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 
2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 
2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 
2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 
2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013), 
    Player = c("Adrian Mannarino", "Adrian Menendez-Maceiras", 
    "Adrian Ungur", "Albano Olivetti", "Albert Montanes", "Albert Ramos-Vinolas", 
    "Alejandro Falla", "Alex Bogomolov Jr.", "Alexandr Dolgopolov", 
    "Andreas Haider-Maurer", "Andreas Seppi", "Andrey Kuznetsov", 
    "Andy Murray", "Antonio Veic", "Benjamin Balleret", "Benjamin Becker", 
    "Benoit Paire", "Bernard Tomic", "Bjorn Phau", "Blaz Kavcic", 
    "Bobby Reynolds", "Bradley Klahn", "Brian Baker", "Carlos Berlocq", 
    "Cedrik-Marcel Stebe", "Cesar Ramirez", "Daniel Brands", 
    "Daniel Gimeno-Traver", "David Ferrer", "David Goffin", "David Nalbandian", 
    "Denis Istomin", "Denis Kudla", "Di Wu", "Dmitry Tursunov", 
    "Donald Young", "Dudi Sela", "Dustin Brown", "Edouard Roger-Vasselin", 
    "Ernests Gulbis", "Evgeny Donskoy", "Fabio Fognini", "Facundo Arguello", 
    "Federico Delbonis", "Feliciano Lopez", "Fernando Verdasco", 
    "Filippo Volandri", "Flavio Cipolla", "Florent Serra", "Florian Mayer", 
    "Frank Dancevic", "Gael Monfils", "Gilles Muller", "Gilles Simon", 
    "Go Soeda", "Grega Zemlja", "Grigor Dimitrov", "Guido Pella", 
    "Guillaume Rufin", "Guillermo Garcia-Lopez", "Henri Laaksonen", 
    "Horacio Zeballos", "Igor Andreev", "Igor Sijsling", "Ivan Dodig", 
    "Ivo Karlovic", "Jack Sock", "James Blake", "James Duckworth", 
    "James Ward", "Jamie Baker", "Jan Hajek", "Jan Hernych", 
    "Janko Tipsarevic", "Jarkko Nieminen", "Javier Marti", "Jeremy Chardy", 
    "Jerzy Janowicz", "Jesse Levine", "Jimmy Wang", "Jo-Wilfried Tsonga", 
    "Joao Sousa", "Joao Souza", "John Isner", "John Millman", 
    "Juan Monaco", "Julien Benneteau", "Jurgen Melzer", "Jurgen Zopp", 
    "Kei Nishikori", "Kenny De Schepper", "Kevin Anderson", "Leonardo Mayer", 
    "Lleyton Hewitt", "Lukas Lacko", "Lukas Rosol", "Lukasz Kubot", 
    "Marcel Granollers", "Marco Chiudinelli", "Marco Trungelliti", 
    "Marcos Baghdatis", "Mardy Fish", "Marin Cilic", "Marinko Matosevic", 
    "Marius Copil", "Martin Klizan", "Mate Pavic", "Matteo Viola", 
    "Matthew Ebden", "Matthias Bachinger", "Michael Berrer", 
    "Michael Llodra", "Michael Russell", "Mikhail Kukushkin", 
    "Mikhail Youzhny", "Milos Raonic", "Mischa Zverev", "Nicolas Almagro", 
    "Nicolas Mahut", "Nikolay Davydenko", "Novak Djokovic", "Olivier Rochus", 
    "Pablo Andujar", "Paolo Lorenzi", "Paul Capdeville", "Paul-Henri Mathieu", 
    "Pere Riba", "Peter Polansky", "Philipp Kohlschreiber", "Philipp Petzschner", 
    "Potito Starace", "Radek Stepanek", "Rafael Nadal", "Rajeev Ram", 
    "Rhyne Williams", "Ricardas Berankis", "Richard Gasquet", 
    "Roberto Bautista Agut", "Robin Haase", "Roger Federer", 
    "Rogerio Dutra Silva", "Ruben Ramirez Hidalgo", "Ryan Harrison", 
    "Sam Querrey", "Santiago Giraldo", "Sergiy Stakhovsky", "Simone Bolelli", 
    "Somdev Devvarman", "Stan Wawrinka", "Steve Darcis", "Steve Johnson", 
    "Tatsuma Ito", "Teymuraz Gabashvili", "Thiemo de Bakker", 
    "Thomaz Bellucci", "Tim Smyczek", "Tobias Kamke", "Tomas Berdych", 
    "Tommy Haas", "Tommy Robredo", "Vasek Pospisil", "Victor Estrella Burgos", 
    "Victor Hanescu", "Viktor Troicki", "Xavier Malisse", "Yen-Hsun Lu", 
    "Yuki Bhambri", "Ze Zhang", "Adrian Mannarino", "Adrian Menendez-Maceiras", 
    "Adrian Ungur", "Albano Olivetti", "Albert Montanes", "Albert Ramos-Vinolas", 
    "Alejandro Falla", "Alex Bogomolov Jr.", "Alexandr Dolgopolov", 
    "Andreas Haider-Maurer", "Andreas Seppi", "Andrey Kuznetsov", 
    "Andy Murray", "Antonio Veic", "Benjamin Balleret", "Benjamin Becker", 
    "Benoit Paire", "Bernard Tomic", "Bjorn Phau", "Blaz Kavcic", 
    "Bobby Reynolds", "Bradley Klahn", "Brian Baker", "Carlos Berlocq", 
    "Cedrik-Marcel Stebe", "Cesar Ramirez", "Daniel Brands", 
    "Daniel Gimeno-Traver", "David Ferrer", "David Goffin", "David Nalbandian", 
    "Denis Istomin", "Denis Kudla", "Di Wu", "Dmitry Tursunov", 
    "Donald Young", "Dudi Sela", "Dustin Brown", "Edouard Roger-Vasselin", 
    "Ernests Gulbis", "Evgeny Donskoy", "Fabio Fognini", "Facundo Arguello", 
    "Federico Delbonis", "Feliciano Lopez", "Fernando Verdasco", 
    "Filippo Volandri", "Flavio Cipolla", "Florent Serra", "Florian Mayer", 
    "Frank Dancevic", "Gael Monfils", "Gilles Muller", "Gilles Simon", 
    "Go Soeda", "Grega Zemlja", "Grigor Dimitrov", "Guido Pella", 
    "Guillaume Rufin", "Guillermo Garcia-Lopez", "Henri Laaksonen", 
    "Horacio Zeballos", "Igor Andreev", "Igor Sijsling", "Ivan Dodig", 
    "Ivo Karlovic", "Jack Sock", "James Blake", "James Duckworth", 
    "James Ward", "Jamie Baker", "Jan Hajek", "Jan Hernych", 
    "Janko Tipsarevic", "Jarkko Nieminen", "Javier Marti", "Jeremy Chardy", 
    "Jerzy Janowicz", "Jesse Levine", "Jimmy Wang", "Jo-Wilfried Tsonga", 
    "Joao Sousa", "Joao Souza", "John Isner", "John Millman", 
    "Juan Monaco", "Julien Benneteau", "Jurgen Melzer", "Jurgen Zopp", 
    "Kei Nishikori", "Kenny De Schepper", "Kevin Anderson", "Leonardo Mayer", 
    "Lleyton Hewitt", "Lukas Lacko", "Lukas Rosol", "Lukasz Kubot", 
    "Marcel Granollers", "Marco Chiudinelli", "Marco Trungelliti", 
    "Marcos Baghdatis", "Mardy Fish", "Marin Cilic", "Marinko Matosevic", 
    "Marius Copil", "Martin Klizan", "Mate Pavic", "Matteo Viola", 
    "Matthew Ebden", "Matthias Bachinger", "Michael Berrer", 
    "Michael Llodra", "Michael Russell", "Mikhail Kukushkin", 
    "Mikhail Youzhny", "Milos Raonic", "Mischa Zverev", "Nicolas Almagro", 
    "Nicolas Mahut", "Nikolay Davydenko", "Novak Djokovic", "Olivier Rochus", 
    "Pablo Andujar", "Paolo Lorenzi", "Paul Capdeville", "Paul-Henri Mathieu", 
    "Pere Riba", "Peter Polansky", "Philipp Kohlschreiber", "Philipp Petzschner", 
    "Potito Starace", "Radek Stepanek", "Rafael Nadal", "Rajeev Ram", 
    "Rhyne Williams", "Ricardas Berankis", "Richard Gasquet", 
    "Roberto Bautista Agut", "Robin Haase", "Roger Federer", 
    "Rogerio Dutra Silva", "Ruben Ramirez Hidalgo", "Ryan Harrison", 
    "Sam Querrey", "Santiago Giraldo", "Sergiy Stakhovsky", "Simone Bolelli", 
    "Somdev Devvarman", "Stan Wawrinka", "Steve Darcis", "Steve Johnson", 
    "Tatsuma Ito", "Teymuraz Gabashvili", "Thiemo de Bakker", 
    "Thomaz Bellucci", "Tim Smyczek", "Tobias Kamke", "Tomas Berdych", 
    "Tommy Haas", "Tommy Robredo", "Vasek Pospisil", "Victor Estrella Burgos", 
    "Victor Hanescu", "Viktor Troicki", "Xavier Malisse", "Yen-Hsun Lu", 
    "Yuki Bhambri", "Ze Zhang"), Rate = c(40.1068555159279, 48.5972850678733, 
    42.2619542619543, 38.6440677966102, 41.6947087985997, 44.7355437724201, 
    41.4975914066883, 41.0146858202311, 38.7453772000567, 34.0845070422535, 
    40.5287678969862, 42.0047885075818, 45.7484673774191, 53.5714285714286, 
    38.8524590163934, 39.4191438337871, 36.2289303326132, 37.3859935133823, 
    43.4670160647146, 46.8187025077667, 42.1153846153846, 39.9830488363026, 
    39.3572492714896, 46.7791186330243, 44.7090774117017, 49.4117647058824, 
    42.8339013407087, 39.7583642372835, 43.7353828040564, 41.1020778123099, 
    43.5395647089904, 40.9054563314093, 44.2585551330798, 40.3738317757009, 
    38.8826209133901, 37.7108665907316, 39.8128065651371, 33.8937111038323, 
    40.4229079329346, 41.0104772879351, 48.2926829268293, 39.7940607952855, 
    43.7704918032787, 43.4199071956081, 41.4313444022969, 44.6821941190427, 
    40.3781072660046, 42.2115252283724, 40.3011277916591, 37.4560517920488, 
    41.8939079983423, 41.7043195369705, 41.4132372901059, 44.346551703472, 
    42.7720449005249, 40.5418371723473, 40.5841627857165, 39.6694214876033, 
    43.2557223238899, 43.7532498877444, 39.8076923076923, 40.79011761851, 
    36.3157894736842, 37.8800779343798, 41.6525889241354, 42.351420362993, 
    42.6899845232471, 37.0531706057283, 41.1089763779528, 43.0956676752043, 
    36.3829787234043, 37.2688588007737, 35.4679144385027, 44.7274556308737, 
    39.4538617379856, 43.8461538461538, 41.09684129998, 41.7378889816565, 
    40.5608809396408, 39.9056603773585, 42.3398614316335, 47.3207547169811, 
    47.4543189368771, 39.8223846754192, 36, 47.3911952603488, 
    42.7891441754976, 38.5052945708341, 40.2989900235425, 43.9218758211041, 
    38.6486882215174, 43.4825530093826, 46.895434085602, 44.5057840595424, 
    41.0068183948249, 37.221203601361, 44.1885523559565, 46.0213778517772, 
    45.8775728414862, 52.9411764705882, 41.3771241297421, 44.2357363891733, 
    42.9418066092048, 42.1191202133946, 37.1938480051141, 40.4208924428361, 
    37.7319587628866, 44.0963855421687, 39.8741790098892, 40.4587169291319, 
    38.0405602567844, 38.940570456339, 45.6464476641825, 41.0052853673887, 
    43.0375408929393, 40.4141640726316, 40.9090909090909, 41.7032591055249, 
    40.1697044503106, 41.4970483273488, 44.6910144837226, 42.891988875354, 
    44.5188919447093, 44.0219355597941, 43.6363636363636, 44.5675073199302, 
    49.5505617977528, 43.8157894736842, 41.1884213721166, 34.3474347434743, 
    44.6368374737697, 43.6762446979612, 51.2648736572277, 44.4, 
    45.0955414012739, 38.2847268673356, 43.4958084437578, 45.556079786015, 
    39.8522217548194, 39.4797737609062, 40.4081632653061, 46.027027027027, 
    42.0796474270302, 38.1159849469023, 42.0530722363042, 40.7525105054581, 
    48.7290969899665, 45.781990521327, 41.5137523002148, 44.0167847666579, 
    41.0260451227605, 38.930822334244, 41.1290322580645, 42, 
    42.90708226956, 36.0253359352995, 40.349353659919, 45.8799205894974, 
    42.7822335774555, 43.4130863076747, 43.0222959121855, 40.3738317757009, 
    40.1067364880382, 41.9675976903149, 39.2784140658924, 43.944060413803, 
    46.5, 42.5930550514217, 37.8526983698187, 42.9341463414634, 
    38.786220619326, 36.536312849162, 37.4478338778745, 43.3025949600477, 
    37.4518438767764, 39.7912792220513, 36.7586542400021, 38.2075471698113, 
    38.7786699067654, 36.4086157744694, 43.040282308796, 41.3333333333333, 
    38.0898876404494, 38.8476439793085, 36.0611575379137, 35.2817469782592, 
    40.7466702338214, 41.4182989529498, 42.8183288409704, 37.7935943060498, 
    38.8759511914156, 42.5722063401088, 34.3376623376623, 36.5853658536585, 
    37.2556920956119, 39.6579631852775, 41.3104132610534, 37.5593986676354, 
    40.3500211477867, 37.683973068715, 38.8235294117647, 36.7567567567568, 
    36.5561473376695, 36.7568250824919, 38.0952422710061, 32.0674601745168, 
    37.9041579501237, 41.2581162405274, 42.3076923076923, 38.8164478914919, 
    44.1409691629956, 40.543494896481, 38.7860610641817, 41.4788140850178, 
    37.7856993609517, 40.453709690869, 34.4894639735871, 37.1323908852846, 
    40.353185004281, 38.7287311824755, 39.326006873073, 41.6881716957191, 
    37.9896386398132, 37.3317660822495, 38.2133249890243, 31.8320610687023, 
    38.821893660789, 41.85598116368, 35.8695652173913, 40.1800080325772, 
    39.2156862745098, 35.4564883535419, 37.5564356980916, 37.6243739044858, 
    39.4961089653045, 34.0315135198579, 41.3019812256383, 37.7881145240196, 
    31.858407079646, 44.16, 33.2307692307692, 42.3317271815333, 
    37.999270009588, 42.4242424242424, 39.809446972348, 38.077546141975, 
    38.9676581230207, 33.4969325153374, 39.0509394220647, 37.9971988795518, 
    46.5617742329789, 39.5302584168823, 42.1475409836066, 39.7287594576068, 
    42.3158416534702, 38.2952743456704, 40.6041819808423, 40.8006369031146, 
    37.0294436681686, 40.6160577385492, 42.2578660689667, 42.1598775639263, 
    38.2484689860671, 35.2431286535672, 39.2004939466502, 41.2081637139706, 
    41.3392024253731, 39.3103448275862, 38.4529127577636, 42.9128662678417, 
    41.0152013673961, 39.791219429731, 36.6291835784151, 40.8605205853744, 
    38.2677165354331, 40, 39.0319398701759, 39.7877559087205, 
    37.3255813953488, 35.8469428084007, 39.3841342920106, 38.7737191650854, 
    41.318082485333, 39.4897980924021, 32.2073841319717, 38.9087133294715, 
    41.790383507799, 38.8738807993883, 41.6389695068945, 38.7850485246917, 
    41.2500379274582, 40.2216211205045, 35.8483228001945, 38.5792922687451, 
    40.8571428571429, 43.4730538922156, 38.6446324623331, 38.4772803207484, 
    36.6569681197137, 45.5950825023844, 45.6667444878909, 37.8688524590164, 
    44.8920863309352, 33.6196308998857, 39.7846893157907, 41.6863024679599, 
    38.2657197622353, 37.3672569969907, 42.4615384615385, 49.6296296296296, 
    38.8914195417481, 35.3764727965691, 38.29557445423, 35.5735687769318, 
    41.6340689121177, 40.4292208949902, 39.2833014547378, 39.6324531949532, 
    39.1836734693878, 37.7279453002892, 41.3445378151261, 37.7256637168142, 
    39.6856103950739, 38.8776460538295, 40.3649422406606, 41.7085287581192, 
    39.262659846638, 40.9527078661513, 42.9897009263436, 37.3547215496368, 
    38.2097857890441, 39.2808918678121, 38.4396526294813, 41.013370903628, 
    40.4761904761905, 38.0736479543713), Matches = c(6L, 1L, 
    2L, 1L, 24L, 56L, 47L, 12L, 81L, 1L, 79L, 2L, 82L, 1L, 1L, 
    15L, 61L, 39L, 2L, 14L, 1L, 2L, 3L, 48L, 5L, 1L, 4L, 8L, 
    135L, 15L, 29L, 71L, 1L, 1L, 5L, 6L, 9L, 3L, 19L, 18L, 1L, 
    61L, 1L, 3L, 45L, 65L, 24L, 11L, 5L, 55L, 2L, 23L, 14L, 88L, 
    10L, 6L, 53L, 1L, 4L, 29L, 1L, 4L, 1L, 6L, 37L, 28L, 8L, 
    32L, 2L, 3L, 1L, 2L, 2L, 89L, 54L, 1L, 25L, 8L, 5L, 1L, 88L, 
    1L, 2L, 85L, 1L, 58L, 68L, 52L, 6L, 59L, 3L, 61L, 33L, 14L, 
    16L, 43L, 39L, 54L, 3L, 1L, 65L, 19L, 48L, 16L, 3L, 10L, 
    1L, 1L, 27L, 19L, 2L, 39L, 23L, 10L, 85L, 88L, 1L, 108L, 
    21L, 58L, 147L, 16L, 72L, 11L, 1L, 16L, 2L, 1L, 77L, 3L, 
    5L, 36L, 59L, 1L, 2L, 5L, 89L, 7L, 48L, 130L, 1L, 2L, 43L, 
    79L, 50L, 20L, 2L, 1L, 85L, 8L, 2L, 6L, 1L, 1L, 50L, 5L, 
    27L, 91L, 39L, 13L, 6L, 1L, 8L, 44L, 47L, 28L, 1L, 3L, 4L, 
    2L, 4L, 1L, 31L, 54L, 44L, 7L, 56L, 1L, 69L, 4L, 85L, 1L, 
    1L, 23L, 54L, 35L, 7L, 21L, 2L, 1L, 6L, 50L, 2L, 1L, 5L, 
    18L, 123L, 17L, 21L, 76L, 1L, 1L, 3L, 4L, 4L, 3L, 16L, 14L, 
    3L, 75L, 1L, 5L, 55L, 51L, 24L, 5L, 3L, 71L, 3L, 23L, 8L, 
    69L, 16L, 15L, 43L, 2L, 8L, 23L, 1L, 7L, 1L, 14L, 49L, 23L, 
    6L, 13L, 2L, 2L, 1L, 1L, 1L, 56L, 73L, 1L, 42L, 15L, 5L, 
    1L, 87L, 2L, 3L, 71L, 2L, 36L, 56L, 67L, 6L, 58L, 5L, 82L, 
    33L, 33L, 17L, 34L, 39L, 62L, 2L, 1L, 46L, 12L, 46L, 30L, 
    2L, 17L, 1L, 1L, 10L, 6L, 1L, 28L, 16L, 2L, 92L, 86L, 2L, 
    107L, 11L, 64L, 141L, 12L, 66L, 22L, 2L, 23L, 1L, 1L, 81L, 
    2L, 3L, 32L, 65L, 1L, 1L, 3L, 93L, 16L, 52L, 88L, 1L, 1L, 
    36L, 66L, 42L, 9L, 5L, 2L, 93L, 10L, 1L, 8L, 1L, 2L, 27L, 
    4L, 39L, 93L, 88L, 8L, 8L, 3L, 11L, 42L, 37L, 43L, 1L, 3L
    ), Lower = c(33.7132034632035, 48.5972850678733, 40.42079002079, 
    38.6440677966102, 32.7875079465989, 37.6271186440678, 36.5413533834586, 
    35.9785267880989, 34.3448275862069, 34.0845070422535, 34.5186440677966, 
    39.6861931364725, 37.5740740740741, 53.5714285714286, 38.8524590163934, 
    33.8940533151059, 31.0810810810811, 33.4049210638601, 43.0947932095249, 
    37.2289156626506, 42.1153846153846, 37.8868679334836, 36.2408865558472, 
    40.1842105263158, 42.0967741935484, 49.4117647058824, 41.509148486981, 
    35.4268464037938, 36.2790697674419, 36.8331108144192, 38.9568106312292, 
    33.7289321857562, 44.2585551330798, 40.3738317757009, 36.6486486486486, 
    36.3870967741936, 38.0104712041885, 33.2149525057321, 36.6524416135881, 
    33.781512605042, 48.2926829268293, 33.3834586466165, 43.7704918032787, 
    40.7748251748252, 36.0402684563758, 38.6175022606249, 35.9228070175439, 
    39.4626743232158, 38.0591133004926, 32.0388349514563, 40.7563199336925, 
    33.555526556179, 35.4385964912281, 38.8536299765808, 37.3019379844961, 
    37.4046920821114, 34.9473684210526, 39.6694214876033, 36.9876693766938, 
    39.8823529411765, 39.8076923076923, 39.2559488272921, 36.3157894736842, 
    35.0525328330206, 34.9367088607595, 36.6729758617618, 38.5129348795718, 
    33.9205827067669, 36.8510551181102, 40.8806845328584, 36.3829787234043, 
    37.1087040618956, 35.0467914438503, 39.4936708860759, 34.1552795031056, 
    43.8461538461538, 36.5274725274725, 37.1846069972007, 37.6832298136646, 
    39.9056603773585, 36.6098736702128, 47.3207547169811, 46.2097176079734, 
    35.2293577981651, 36, 40.8510638297872, 37.7245508982036, 
    33.7227369921597, 37.3918128654971, 37.7022471910112, 35.4590254911391, 
    38.7037037037037, 40.3636363636364, 37.8719008264463, 34.3055517288883, 
    33.75, 38.2858064516129, 39.0604026845638, 44.2046511627907, 
    52.9411764705882, 37.8878904578519, 38.8235294117647, 37.741935483871, 
    35.2354208692463, 34.4098522167488, 31.5095864661654, 37.7319587628866, 
    44.0963855421687, 32.9417124783493, 37.6470588235294, 37.847534286548, 
    34.0187724820144, 39.3227807486631, 36.2962962962963, 37.2972972972973, 
    34.3548387096774, 40.9090909090909, 36.7923444976077, 37.1428571428571, 
    35.9717196724433, 37.2794918330309, 38.961038961039, 38.5714285714286, 
    38.7757437070938, 43.6363636363636, 40, 49.5505617977528, 
    43.8157894736842, 35.3247335175681, 29.7029702970297, 41.8181818181818, 
    37.1260107816712, 44.2718446601942, 44.4, 45.0955414012739, 
    33.8801687763713, 35.8762886597938, 42.3507228158391, 35.1943117672601, 
    33.5277272727273, 40.4081632653061, 43.3027027027027, 36.5562913907285, 
    33.8888277380297, 35.3932584269663, 36.4107160445189, 46.4113712374582, 
    45.781990521327, 35.2941176470588, 41.3348361450456, 40.3071499668215, 
    33.0689160086145, 41.1290322580645, 42, 38.3625772038181, 
    31.853202644176, 34.4923636363636, 40.7008547008547, 36.8201759208356, 
    40.3200979891804, 37.4930855018587, 40.3738317757009, 37.7319587628866, 
    37.7622377622378, 34.4736842105263, 38.5602836879433, 46.5, 
    40.5511578947368, 35.9128205128205, 41.7334146341463, 38.5026737967914, 
    36.536312849162, 30.5455923212933, 39.0921485902449, 32.3995036243303, 
    35.540555870675, 32.2609625136721, 38.2075471698113, 33.8255033557047, 
    35.4146341463415, 37.2549019607843, 41.3333333333333, 38.0898876404494, 
    34.5762711864407, 30.1357466063348, 30.2950819672131, 38.135593220339, 
    33.1468531468531, 41.6189757412399, 37.7935943060498, 34.639175257732, 
    35.3684210526316, 34.0337662337662, 36.5853658536585, 34.2077499185933, 
    36, 36.8494505494505, 32.8846153846154, 38.0232558139535, 
    31.9659366193702, 38.8235294117647, 36.7567567567568, 35.5966755319149, 
    35.1896392229417, 30.6868137207268, 31.6950398040416, 35.1857142857143, 
    38.2190476190476, 41.6538461538462, 33.1082664147378, 44.1409691629956, 
    37.3955302234888, 33.6842105263158, 36.6666666666667, 34.5741626794258, 
    35.4634601226994, 33.8486842105263, 32.6206196038598, 39.6450157765572, 
    34.7546333353857, 37.1875, 35.8823529411765, 33.8931297709924, 
    33.2142857142857, 34.3428571428571, 31.8320610687023, 36.0483870967742, 
    37.0754716981132, 35.8695652173913, 36.1194029850746, 39.2156862745098, 
    33.4491978609626, 33.3333333333333, 34.0567589482219, 37.6059113300493, 
    30.2235381199112, 37.196277417718, 37.3463790199695, 31.858407079646, 
    44.16, 33.2307692307692, 34.8979591836735, 33.7718446601942, 
    42.4242424242424, 36.2686567164179, 32.5986833933673, 35.9085154747333, 
    33.4969325153374, 34.2465753424658, 36.7997198879552, 43.5055693069307, 
    34.5804195804196, 42.0147540983607, 35.2308510638298, 35.1826826826827, 
    34.4360454291566, 37.4117647058824, 37.0469798657718, 35.9968978307295, 
    36.0902255639098, 39.6382007822686, 34.1626794258373, 31.4285714285714, 
    30.5397727272727, 34.6169282222794, 37.1259954318168, 41.208547108209, 
    39.3103448275862, 35.2631578947368, 41.3193084455324, 35.4385964912281, 
    34.9625454545455, 36.1441213653603, 35.6043956043956, 38.2677165354331, 
    40, 35.0545638432364, 36.0594059405941, 37.3255813953488, 
    30.826209086468, 33.9622641509434, 36.4361954459203, 36.4434900542496, 
    35.4243542435424, 31.6417910447761, 33.8570135746606, 39.5652173913043, 
    33.7368421052632, 35.1020408163265, 30.5882352941176, 35.7615894039735, 
    33.5779929249674, 34.1944579484686, 34.9125902165196, 40.8571428571429, 
    43.4730538922156, 34.5115889883692, 37.8751252923488, 35.3910214703969, 
    34.5072252716478, 40.78125, 37.8688524590164, 44.8920863309352, 
    32.8243508084272, 35.5384615384615, 35.6175298804781, 34.803007518797, 
    32.9305555555556, 42.4615384615385, 49.6296296296296, 34.3717948717949, 
    31.9094258214404, 32.3353293413174, 31.374613003096, 40.2439024390244, 
    40.3598234979497, 33.0879765395894, 36.2962962962963, 39.1836734693878, 
    32.5984251968504, 41.3445378151261, 33.8787610619469, 35.9923664122137, 
    34.2641598119859, 35.6435643564356, 36.4285714285714, 35.1706796708321, 
    36.0408876463393, 39.6825652594264, 36.5357142857143, 34.9484536082474, 
    34.8979591836735, 33.9786259541985, 38.2105263157895, 40.4761904761905, 
    37.1855931678941), Upper = c(44.9372384937238, 48.5972850678733, 
    44.1031185031185, 38.6440677966102, 45.355577689243, 49.0909090909091, 
    48.0662983425414, 43.7837837837838, 44.2718446601942, 34.0845070422535, 
    47.2811059907834, 44.3233838786911, 54.4237288135593, 53.5714285714286, 
    38.8524590163934, 44.648622754491, 42.1276595744681, 43.2493746304635, 
    43.8392389199043, 52.6944444444444, 42.1153846153846, 42.0792297391216, 
    42.5422049956934, 57.6603341584158, 49.508137603796, 49.4117647058824, 
    44.0390625, 43.84, 50.5970149253731, 46.285582939599, 49.585666293393, 
    47.3847399504668, 44.2585551330798, 40.3738317757009, 42.4311073541843, 
    39.1139240506329, 42.1875, 34.5724697019325, 46.9276565464896, 
    46.2352941176471, 48.2926829268293, 46.3235294117647, 43.7704918032787, 
    45.3260571204496, 48.3333333333333, 52.8612440191388, 47.5684210526316, 
    44.8051948051948, 42.7866816924495, 42.4844720496894, 43.0314960629921, 
    60.7928603569821, 43.5348837209302, 52.0754716981132, 45.8948171789357, 
    44.3382352941177, 45.3333333333333, 39.6694214876033, 48.0016383763838, 
    48.4615384615385, 39.8076923076923, 43.1367106176266, 36.3157894736842, 
    41.3626584259114, 47.1739955950482, 49.8681818181818, 48.0634583789704, 
    41.8978556228515, 45.3668976377953, 45.2258699384448, 36.3829787234043, 
    37.4290135396518, 35.8890374331551, 48.9759036144578, 43.634703852789, 
    43.8461538461538, 45.4615384615385, 45.5319952774498, 44.5731349886634, 
    39.9056603773585, 48.1132075471698, 47.3207547169811, 48.6989202657807, 
    47.1233141119985, 36, 54.6666666666667, 49.9669209714053, 
    44.2105263157895, 42.8211636079656, 52.7272727272727, 40.9706449974606, 
    48.5889570552147, 53.2235294117647, 50.6688298095039, 46.2955879736702, 
    42.9383886255924, 52, 52.8440366972477, 47.4322373696873, 
    52.9411764705882, 46.31789670359, 52.0879120879121, 49.0322580645161, 
    46.7964008468596, 38.9100891211973, 44.2379516828412, 37.7319587628866, 
    44.0963855421687, 45.7503974562798, 44.3835616438356, 38.2335862270207, 
    42.8571428571429, 51.4143717728055, 44.641638225256, 50.4833870567815, 
    44.7272727272727, 40.9090909090909, 47.3927844588344, 42.7777777777778, 
    48.0117921385743, 55.7348837209302, 46.08, 49.5993460915472, 
    50.7325612712093, 43.6363636363636, 51.0319472616633, 49.5505617977528, 
    43.8157894736842, 48.3407470288625, 42.2430243024302, 48.1283422459893, 
    48.6206896551724, 59.1608391608392, 44.4, 45.0955414012739, 
    40.9691799669785, 49.4445353403141, 50.9833772368062, 46.0433694745621, 
    45.8015267175573, 40.4081632653061, 48.7513513513514, 48.8372093023256, 
    42.046875, 49.2857142857143, 46.25, 51.0468227424749, 45.781990521327, 
    46.8292682926829, 46.2352941176471, 41.7449402786994, 43.3429528951778, 
    41.1290322580645, 42, 51.4285714285714, 39.7142857142857, 
    46.4170928889622, 52.7748691099476, 49.0577395577396, 47.1250476553565, 
    47.3793103448276, 40.3738317757009, 44.4534412955466, 46.7441860465116, 
    42.2608695652174, 56.3009350393701, 46.5, 44.6079854809437, 
    40.7628245327982, 44.1348780487805, 39.0697674418605, 36.536312849162, 
    42.9176755447942, 50.3496503496503, 43.248730964467, 43.8918918918919, 
    41.25, 38.2075471698113, 43.2463397005679, 37.4025974025974, 
    49.811320754717, 41.3333333333333, 38.0898876404494, 42.7204898728215, 
    41.4545454545455, 41.3667943468498, 44.7619047619048, 49.9378881987578, 
    44.0176819407008, 37.7935943060498, 46.6945606694561, 48.3529411764706, 
    34.6415584415584, 36.5853658536585, 41.2070408310489, 46.2295081967213, 
    46.3813953488372, 39.4142054164538, 44.1509433962264, 42.555, 
    38.8235294117647, 36.7567567567568, 37.5111722797927, 38.577264287188, 
    44.2250155008173, 32.669711362806, 41.1976744186046, 45.384007585335, 
    42.6923076923077, 44.4452314697698, 44.1409691629956, 44.3181041358095, 
    42.9126213592233, 44.8888888888889, 45.1401414039391, 44.25, 
    34.9570790444747, 41.6234616391726, 41.4492872525895, 48.0702176844539, 
    41.4388489208633, 48.4758620689655, 43.1707317073171, 40.4938271604938, 
    42.5925925925926, 31.8320610687023, 42.3335934451814, 50.9016740621218, 
    35.8695652173913, 45, 39.2156862745098, 37.1434145623205, 
    42.600209945181, 43.7782805429864, 43.2157185268394, 37.2806569594921, 
    45.4076850335586, 38.2298500280696, 31.858407079646, 44.16, 
    33.2307692307692, 48.1132075471698, 43.3135241424514, 42.4242424242424, 
    43.8157894736842, 42.4691358024691, 40.5460317460317, 33.4969325153374, 
    42.7272727272727, 39.1946778711485, 49.3597359735974, 42.680412371134, 
    42.2803278688525, 45.6281076638586, 45.7664233576642, 42.3251298261459, 
    43.3064516129032, 44.075514475061, 38.0359048465985, 44.3835616438356, 
    46.8062415806017, 47.7574833427255, 44.5659163987138, 39.8673469387755, 
    42.2518164626257, 44.3973913043478, 41.4698577425373, 39.3103448275862, 
    43.6024844720497, 44.7398843930636, 46.4661654135338, 43.6923076923077, 
    37.1142457914698, 48.4729064039409, 38.2677165354331, 40, 
    41.7135221380136, 43.7389758179232, 37.3255813953488, 39.0621055289068, 
    43.3489154824233, 41.1112428842505, 47.4107142857143, 43.6363636363636, 
    32.7729772191673, 44.2452830188679, 45.2746411483254, 43.4782608695652, 
    49.811320754717, 43.4594594594595, 46.7760869565217, 45.8571207550089, 
    37.5021876519203, 45.2192307692308, 40.8571428571429, 43.4730538922156, 
    44.6225736879942, 39.079435349148, 37.4318490566038, 80.261780104712, 
    50.2714546561169, 37.8688524590164, 44.8920863309352, 34.1397354238119, 
    45.3913043478261, 45.8241758241758, 42.1524725274725, 43.5789473684211, 
    42.4615384615385, 49.6296296296296, 44.3223647518126, 39.4914606741573, 
    43.68, 39.1356885974191, 43.5555555555556, 40.4986182920307, 
    45.3409090909091, 43.75, 39.1836734693878, 41.2936900711414, 
    41.3445378151261, 41.5725663716814, 44.0764930862018, 41.6885324232082, 
    45.6569450581824, 46.2222222222222, 43.8235294117647, 45.9898832684825, 
    48.9377777777778, 38.0720338983051, 40.6666666666667, 44.1573033707865, 
    42.6186421173763, 44.5161290322581, 40.4761904761905, 39.4733961690483
    )), .Names = c("Year", "Player", "Rate", "Matches", "Lower", 
"Upper"), row.names = c(NA, -336L), class = "data.frame")


sidebar <- dashboardSidebar(
  sidebarMenu(
    menuItem("Context", tabName = "context", icon = icon("th-large")),
    menuItem("Change from 2012 to 2013", icon = icon("line-chart"), tabName = "overall"),
    menuItem("Change adjusted for trends", icon = icon("line-chart"), tabName = "trends"),
    menuItem("Surface effects", icon = icon("line-chart"), tabName = "surface"),
    menuItem("Tier effects", icon = icon("line-chart"), tabName = "tier"),
    menuItem("Player effects", icon = icon("line-chart"), tabName = "player")
  )
)

body <- dashboardBody(
		
   tabItems(
      tabItem(tabName = "context",
      
      h2("Length of Points in Tennis"),
      fluidRow(
      	column(4, 
      		tags$img(src = "images/nadal.jpg", width = "100%", height = "90%")
      	),
		column(7,
	      p("The virtual elimination of the serve-and-volley game has been one of the most significant changes to happen in the sport of tennis in recent years. In today's game, the fast-paced, big serving play that characterized the nineties has been replaced by long battles at the baseline."),
	      
	      p("A consequence of this switch in playing style has been a general slowing of the game. Marathon matches (typified by the Isner-Mahut epic at the 2010 Wimbledon Championships) have become a norm at the Grand Slams, complicating schedules, draining players, and exhausting fans.")
	      ),
	     fluidRow(
    	      br(),
	      column(10, offset = 1,
	      p("In recognition of the slowing game, the Association of Tennis Professionals (ATP), the governing body of men's professional tennis, introduced", 
	      a("a change",  href = "http://www.usatoday.com/story/sports/tennis/2013/03/10/rafael-nadal-time-violation-rule-atp-bnp-paribas-open/1977477/"), 
	      "in 2013 in an effort to speed up the game. The change concerned current limits on the time players can take between points. For a long time, players have been required to take no more than 20 seconds at Grand Slams (20 seconds at all other tournaments) from the end of a point to the next serve. Though this rule is tantamount to a shot clock on paper, it rarely was in practice because it was rarely enforced. That is, until 2013."),
	      
	      p("In this year, the ATP gave chairs, who officiate the the Tour rules during a match, greater leeway to enforce the time rules by allowing the issue of a fault to a server, after he has been warned about being too slow between points. Previously, a warning was followed by an automatic loss of a point, which chairs felt was too severe a punishmanet to use."),
	      
	      p("Has the ATP's rule change had an effect? And, if so, has it been a global one? Or have some players had to adapt more than others?"),
	      
			p("A", a("recent article", href = "http://fivethirtyeight.com/features/why-some-tennis-matches-take-forever/"), "by Carl Bialik of Fivetirthyeight suggests that the ATP's rule change has caused players to quicken their pace overall. On average, Bialik estimates that the new enforcement rules sped up each point by 2.6 seconds."),
	      
	      p("In these pages, I try to delve a bit deeper into the impact of the ATP's policy change on time violations. Specifically, I consider conditions and players that were most and least affected by the change. Also, I argue that the average decrease of 2.6 seconds underestimates the actual effect of the rule change because it does not account for the steady slowing of the game that was occurring prior to 2013.")
	      )))
    ),
 
     tabItem(tabName = "overall",
    	h2("Average Change in Duration of Points with Rule Change"),
    	fluidRow(
    		column(width = 11,
    		p("One measure of the impact of the ATP's time rule change is to compare the average time to play a point in 2012 (the year before the rule went into effect) and 2013 (the year the rule change was implemented). This includes",
    		length(unique(duration_player$Player)),"total players,",
    		duration_overall$Matches[1],"matches in 2012 and",
    		duration_overall$Matches[2],"matches in 2013.")
    			)),
    	fluidRow(
    		column(width = 5,
      			p("The figure on the right shows the average length per point in the pre-rule year (2012) and the post-rule year (2013). It took", format(duration_overall$Rate[1], ns = 1, dig =1), "seconds per point on average in 2012, but only", format(duration_overall$Rate[2], ns = 1, dig =1), "in 2013--a difference of", format(abs(diff(duration_overall$Rate)), ns = 1, dig =1),"seconds."),
      			p("A difference of",format(abs(diff(duration_overall$Rate)), ns = 1, dig =1),"seconds might not seem like much until one considers what this implies for match length. A typical men's singles match in tennis has 200 total points. So a match in 2012, was typically", format(duration_overall$Rate[1] * 200 / 60, ns = 1, dig =1),"minutes long. With the change in 2013, however, this dropped to", format(duration_overall$Rate[2] * 200 / 60, ns = 1, dig =1),"."),
      			em("What caused play to get so much faster?"),
      			br(),
      			p("I have focused on the ATP's rule change. But this might not be the only factor. The reason for this is that the point length measured here is the time from the end of one point to the end of the next, which includes both the time it takes to play a point and the time it takes a player to prepare to serve (the 'time between points'). Because public data on match duration does not correct for prep time, it is not possible to separate these two time components in the data shown here."),
      			p("The ATP rule change affects the time between points", em("not"), "the length of play. Consequently, a general shift in the strategy of play that resulted in shorter points could also be the cause of the decline in match length between 2012 and 2013. However, the following tab that shows the trends in match duration during the 2000s suggests that the likelihood that players suddenly began to play faster points in 2013 is highly remote.")
      			),
      		column(width = 6,
      			showOutput("chart1", "polycharts")
      			)
      )
    ),
    
    tabItem(tabName = "trends",
   	   h2("How Did the Change in ATP's Time Policy Disrupt Trends in Point Length?"),
   	   br(),
      fluidRow(
      	column(5, 
      	p("If we use the simple comparison of point lengths between 2012 and 2013 to estimate the impact of the ATP policy, we are making the assumption that point lengths in 2013 would have been similar to those in 2012 had the policy change not occurred. But is this assumption reasonable?"),
      	p("The figure on the right shows the trends in point length from 2003 to the present. Between 2003 and 2012, the average time to play a point got longer with every year. This suggests that, prior to the rule change, the expected length of points in 2013 would not have been the same as in 2012 but even longer."),
      	p("From the figure on the right, we see that the slowing trends can be well described by a line. The best-fitting line indicates that the game was slowing by 0.4 seconds a point every year during this period. Had these trends continued, the expected duration of a point in 2013 would have been 42.7 seconds."),
      	p("This suggests that the actual effect of the ATP policy change was to speed up the game by 3.2 seconds per point.")),
      column(5, htmlOutput("gvis0"))
      	)),
      	
    
    tabItem(tabName = "surface",
      h2("Was the Impact of the Rule Change the Same for All Surfaces?"),
      fluidRow(
      column(5, htmlOutput("gvis1")),
      column(6,
      	p("If we consider the change in average point lengths by surface between 2012 and 2013, we see that points got faster across all surfaces but some more than others. The pace of the game got the most boost on clay--the slowest of the three major surfaces--increasing by an average of 3.6 seconds a point."),
      	p("Grass--the fastest of the surfaces--underwent the least change. The increase in the time per point was a little more than 1 second.")
      )
    )),
   
    tabItem(tabName = "tier",
   	 h2("Did the Rule Change Change the Pace of Play in the Same Way for All Tournaments?"),
      fluidRow(
       column(5, htmlOutput("gvis2")),
       column(6,
       		p("For tournaments played during the regular season, the impact of the time violation rule change was similar. All changes ranged from 2.2 to nearly 3 seconds per point faster on average: the biggest change occurring at the Masters 1000 level tournaments."),
       		p("The Tour Finals, which is played by the top 8 at the end of the season and follows a round-robin tournament format, was an outlier in terms of the change in the pace of play. This is likely due to the small number of matches that could be evaluated. There were fewer than 10 total matches in either 2012 or 2013.")
       ))
    ),
    
    # Can we draw a line to say who would have negative change
    
   tabItem(tabName = "player",
   	 h2("Which Players were Most Affected by the Rule Change?"),
      fluidRow(
      	column(5, 
      		p("If we look at the change in pace for each player, the scatterplot on the right shows that the majority of players quickened their pace in 2013 compared to 2012, when the penalties associated with time violations were rarely enforced."),
      		p("Still the magnitude of the changes across players are quite variable. If we consider a slow player in 2012 as one with an average pace greater than 45 seconds per point, we see that the range of pace in 2013 ranged from 37 seconds to a very slow 50 seconds per point (Ruben Hidalgo)."),
      		p("A lot of attention has been paid to Rafael Nadal, one of the most decorated players on clay court who was notoriously slow (often obsessively so) between points. Nadal did appear to adapt to the rule change by picking up his pace by an average of 5.6 seconds. A big change but not nearly as much as some players who were also slow in the pre-enforcement era. Joao Sousa, to take one example, had almost a 10-second drop in his point duration. Of course, in terms of the loss in between-poin entertainment value, Nadal stands alone.")
      	),
      	column(6, htmlOutput("gvis3"))
      ),
      br(),
      fluidRow(
      column(11, 
    p("The table below provides the pace in 2012 and 2013 for all players who competed in at least one ATP torunament, at the 250 level or above, in both years. The table can be sorted on any column, and the search box can be used to lookup individual players."),
    em("How would these change affect the length of a player's match?"),
      br(),
    p("To see the expected change in match length, use the following slider to select the number of points played in a match. The final column of the table show the corresponding change in the match duration."),
      br(),
      sliderInput("points",
      	label = "Points Played in Match",
      	min = 1, max = 400, value = 200, width = "60%", step = 20),
      br(),
	DT::dataTableOutput("table1", width = "90%")
    )))
  )
)


shinyApp(
  ui = dashboardPage(skin = "green",
    dashboardHeader(title = "The Pace of Tennis"),
    sidebar,
    body
  ),
  
 server = function(input, output) { 
 
 output$gvis0 <- renderGvis({
 		
 		duration_trends$Observed <- duration_trends$Rate
 		duration_trends$Rate[duration_trends$Year >= 2013] <- NA
 		duration_trends$Observed[duration_trends$Year < 2013] <- NA
 		duration_trends$Predicted[duration_trends$Year < 2013] <- NA
 		
 		names(duration_trends)[2] <- "Pre-2013 Rate"
 		
 		gvisScatterChart(duration_trends, 
 			options = list(trendlines = "{0: {type: 'linear'}}", 
 			    colors = "['#CDDC39', '#4DB6AC', 'grey']",
 				vAxis = "{title: 'Seconds per point'}",
 				hAxis = "{format: '####'}",
 				legend = "{position: 'top'}",
 				width = 500, height = 500)
 			)
	
 	})

 output$chart1 <- renderChart2({
 		
		#  Overall duration effect
		duration_overall_2012 <- data.frame(
			Year = 2012,
			Interval = as.numeric(duration_overall[duration_overall$Year == 2012,c("Lower", "Upper")])
		)
		
		duration_overall_2013 <- data.frame(
			Year = 2013,
			Interval = as.numeric(duration_overall[duration_overall$Year == 2013, c("Lower", "Upper")])
		)
		
		p1 <- rPlot(x = "Year", y = "Rate", data = duration_overall, type = 'point', color = list(const = "#4DB6AC"))

		p1$layer(x = "Year", y = "Interval", type = "line", data = duration_overall_2012)
		p1$layer(x = "Year", y = "Interval", type = "line", data = duration_overall_2013)
		p1$guides(y = list(min = 30, max = 60, numticks = 6, title = "Seconds Per Point"), 
					x=list(min = 2011, max = 2014, numticks = 3))
						
		p1$addParams(width = "450", height = "450", title = "Average Point Length, Before and After Rule Change")
		
	return(p1)
 	})

 output$gvis1 <- renderGvis({
 		
		# Surface effects
		plot_data <- data.frame(
			Rate = round(duration_surface$Rate[1:3] - duration_surface$Rate[4:6], 2),
			Surface = duration_surface$Surface[1:3]
		)
		
		
		gvisColumnChart(data = plot_data, xvar = "Surface", yvar = "Rate",
			options = list( legend = "{position: 'none'}", colors = "['#4DB6AC']",
			vAxis = "{title: 'Decrease in Seconds per Point, 2012 to 2013'}",
			width =  350, height = 350))
		 	})


 output$gvis2 <- renderGvis({
 		
		# Tier effects
		plot_data <- data.frame(
			Rate = round(duration_tier$Rate[1:5] - duration_tier$Rate[6:10], 2),
			Tier = factor(duration_tier$Tier[1:5], levels = c("250", "500", "1000", "Grand Slam", "Tour Finals"))
		)
		
		plot_data <- plot_data[order(plot_data$Tier),]
		
		gvisColumnChart(data = plot_data, xvar = "Tier", yvar = "Rate",
			options = list( legend = "{position: 'none'}", colors = "['#CDDC39']",
			vAxis = "{title: 'Decrease in Seconds per Point, 2012 to 2013'}",
			width =  350, height = 350))
		 	})
		 	
output$gvis3 <- renderGvis({
	# Player-specific
		Change <- duration_player$Rate[duration_player$Year == 2012] - duration_player$Rate[duration_player$Year == 2013]
		
		Player <- c(NA, NA, duration_player$Player[duration_player$Year == 2012])
		
		plot_data <- data.frame(
			Rate2012 = c(0, 1, duration_player$Rate[duration_player$Year == 2012]),
			Positive = c(NA, NA, duration_player$Rate[duration_player$Year == 2013]),
			Negative = c(NA, NA, duration_player$Rate[duration_player$Year == 2013]),
			Equality = c(0, 1, rep(NA, nrow(duration_player)/2)),
			Change = c(NA, NA, Change)
		)
		
		plot_data$Positive[plot_data$Change < 0] <- NA
		plot_data$Negative[plot_data$Change > 0] <- NA
		
		plot_data$Positive.html.tooltip <- paste(Player, format(plot_data$Change, ns = 1, dig = 1), sep = ":")
		plot_data$Negative.html.tooltip <- paste(Player, format(plot_data$Change, ns = 1, dig = 1), sep = ":")
		
		plot_data$Positive.html.tooltip[is.na(plot_data$Positive)] <- NA
		plot_data$Negative.html.tooltip[is.na(plot_data$Negative)] <- NA
		
		plot_data <- plot_data[,c("Rate2012", "Positive", "Positive.html.tooltip", "Negative", "Negative.html.tooltip", "Equality")]
		
		g1 <- gvisScatterChart(data = plot_data, 
			options = list(width = "450", height = "450", 
				series = "{0: {color: '#CDDC39'}, 1: {color: '#4DB6AC'}, 2: {color: 'grey'}}",
				legend = "{position: 'top'}",
				trendlines = "{2: {type: 'linear', color: 'grey'}}",
				vAxis = "{title: 'Seconds per Point in 2013',  
				  viewWindowMode:'explicit',
			 viewWindow:{min:25, max:55}}",
				hAxis = "{title: 'Seconds per Point in 2012', 
				  viewWindowMode:'explicit',
			 viewWindow:{min:25, max:55}}"
			)
		)			
	g1
	})
	
output$table1 <- DT::renderDataTable({
	
			table <- data.frame(
				Player = duration_player$Player[duration_player$Year == 2013],
				Pace_2012 = round(duration_player$Rate[duration_player$Year == 2012], 2),
				Pace_2013 = round(duration_player$Rate[duration_player$Year == 2013], 2),
				Change = round(duration_player$Rate[duration_player$Year == 2012] - duration_player$Rate[duration_player$Year == 2013], 2),
				MatchLength = round((duration_player$Rate[duration_player$Year == 2012] - duration_player$Rate[duration_player$Year == 2013]) * input$points / 60, 2)
		)
		
		names(table)[c(2:3, 5)] <- c("Seconds 2012", "Seconds 2013", "Match Length Change (Minutes)")
		
	table
	}, options = list(lengthChange = FALSE, pageLength = 50))
	
})